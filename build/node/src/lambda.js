"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.waitForReady = exports.versionLambda = exports.syncInvokeLambda = exports.putSources = exports.publishLambda = exports.listSources = exports.invokeLambda = exports.hasLambda = exports.getLatestLambdaARN = exports.getLatestLambda = exports.getLambdaVersion = exports.getLambdaUnqualifiedARN = exports.getLambdaARN = exports.getLambda = exports.deleteSources = exports.deleteSource = exports.deleteLambda = exports.createSources = exports.createSource = void 0;
var _crypto = _interopRequireDefault(require("crypto"));
var Lambda = _interopRequireWildcard(require("@aws-sdk/client-lambda"));
var S3 = _interopRequireWildcard(require("@aws-sdk/client-s3"));
var Text = _interopRequireWildcard(require("@dashkite/joy/text"));
var Time = _interopRequireWildcard(require("@dashkite/joy/time"));
var _helpers = require("./helpers.js");
function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }
function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
var AWS, _createSource, _invokeLambda, createSource, createSources, defaults, deleteLambda, deleteSource, deleteSources, getLambda, getLambdaARN, getLambdaUnqualifiedARN, getLambdaVersion, getLatestLambda, getLatestLambdaARN, hasLambda, invokeLambda, listSources, md5, publishLambda, putSources, syncInvokeLambda, versionLambda, waitForReady;
exports.waitForReady = waitForReady;
exports.versionLambda = versionLambda;
exports.syncInvokeLambda = syncInvokeLambda;
exports.putSources = putSources;
exports.publishLambda = publishLambda;
exports.listSources = listSources;
exports.invokeLambda = invokeLambda;
exports.hasLambda = hasLambda;
exports.getLatestLambdaARN = getLatestLambdaARN;
exports.getLatestLambda = getLatestLambda;
exports.getLambdaVersion = getLambdaVersion;
exports.getLambdaUnqualifiedARN = getLambdaUnqualifiedARN;
exports.getLambdaARN = getLambdaARN;
exports.getLambda = getLambda;
exports.deleteSources = deleteSources;
exports.deleteSource = deleteSource;
exports.deleteLambda = deleteLambda;
exports.createSources = createSources;
exports.createSource = createSource;
AWS = {
  Lambda: (0, _helpers.lift)(Lambda),
  S3: (0, _helpers.lift)(S3)
};
md5 = function (buffer) {
  return _crypto.default.createHash('md5').update(buffer).digest("base64");
};
exports.hasLambda = hasLambda = async function (name) {
  return (await getLambda(name)) != null;
};
exports.getLambda = getLambda = async function (name) {
  var error, lambda;
  try {
    lambda = await AWS.Lambda.getFunction({
      FunctionName: name
    });
    return {
      _: lambda,
      arn: lambda.Configuration.FunctionArn,
      state: lambda.Configuration.State,
      lastStatus: lambda.Configuration.LastUpdateStatus
    };
  } catch (error1) {
    error = error1;
    if (/ResourceNotFoundException/.test(error.toString())) {
      return void 0;
    } else {
      throw error;
    }
  }
};

// AWS added internal state management to Lambda in an effort to improve the performance
// of the invocation cycle. This is a broad helper to wait until the lambda is ready
// to go and accept more changes to its state.
exports.waitForReady = waitForReady = async function (name) {
  var lastStatus, results1, state;
  results1 = [];
  while (true) {
    ({
      state,
      lastStatus
    } = await getLambda(name));
    if (state === "Active" && lastStatus === "Successful") {
      break;
    } else if (state === "Failed") {
      throw new Error(`Lambda [ ${name} ] State is Failed.`);
    } else if (lastStatus === "Failed") {
      throw new Error(`Lambda [ ${name} ] LastUpdateStatus is Failed.`);
    } else {
      results1.push(await Time.sleep(1000));
    }
  }
  return results1;
};
exports.getLambdaVersion = getLambdaVersion = async function (name, version) {
  var Versions, current, i, len;
  ({
    Versions
  } = await AWS.Lambda.listVersionsByFunction({
    FunctionName: name
  }));
  for (i = 0, len = Versions.length; i < len; i++) {
    current = Versions[i];
    if (version === Text.parseNumber(current.Version)) {
      return {
        _: current,
        arn: current.FunctionArn,
        version: Text.parseNumber(currentVersion)
      };
    }
  }
  return void 0;
};
exports.getLatestLambda = getLatestLambda = async function (name) {
  var Versions, current, i, len, max, result, version;
  ({
    Versions
  } = await AWS.Lambda.listVersionsByFunction({
    FunctionName: name
  }));
  result = void 0;
  max = 0;
  for (i = 0, len = Versions.length; i < len; i++) {
    current = Versions[i];
    if (current.Version !== "$LATEST") {
      version = Text.parseNumber(current.Version);
      if (version >= max) {
        max = version;
        result = current;
      }
    } else {
      result = current;
    }
  }
  if (result != null) {
    return {
      _: result,
      arn: result.FunctionArn,
      version: max
    };
  }
};
exports.getLatestLambdaARN = getLatestLambdaARN = async function (name) {
  return (await getLatestLambda(name)).arn;
};
exports.getLambdaARN = getLambdaARN = getLatestLambdaARN;
exports.getLambdaUnqualifiedARN = getLambdaUnqualifiedARN = async function (name) {
  return (await getLambdaARN(name)).split(":").slice(0, -1).join(":");
};
defaults = {
  bucket: "dolores.dashkite.com",
  role: "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
  memory: 128,
  // max size for edge lambdas
  timeout: 5,
  // max timeout for edge lambdas
  handler: "build/lambda/index.handler",
  runtime: "nodejs18.x"
};
exports.publishLambda = publishLambda = async function (name, data, configuration) {
  var _configuration, bucket, environment, handler, memory, role, runtime, timeout;
  ({
    role,
    handler,
    runtime,
    bucket,
    memory,
    timeout,
    environment
  } = {
    ...defaults,
    ...configuration
  });
  _configuration = {
    FunctionName: name,
    Handler: handler,
    Runtime: runtime,
    MemorySize: memory,
    Timeout: timeout,
    TracingConfig: {
      Mode: "PassThrough"
    },
    Role: role
  };
  // if environment?
  //   _configuration.Environment = Variables: environment
  if (await hasLambda(name)) {
    await AWS.Lambda.updateFunctionCode({
      FunctionName: name,
      Publish: false,
      ZipFile: data
    });
    await waitForReady(name);
    await AWS.Lambda.updateFunctionConfiguration(_configuration);
    return waitForReady(name);
  } else {
    await AWS.Lambda.createFunction({
      ..._configuration,
      Code: {
        ZipFile: data
      }
    });
    return waitForReady(name);
  }
};
exports.versionLambda = versionLambda = async function (name) {
  var result;
  result = await AWS.Lambda.publishVersion({
    FunctionName: name
  });
  return {
    _: result,
    arn: result.FunctionArn,
    version: Text.parseNumber(result.Version)
  };
};
exports.deleteLambda = deleteLambda = function (name) {
  return AWS.Lambda.deleteFunction({
    FunctionName: name
  });
};
_invokeLambda = function (name, sync, input) {
  var parameters;
  parameters = {
    FunctionName: name
  };
  parameters.InvocationType = sync ? "RequestResponse" : "Event";
  if (input != null) {
    parameters.Payload = JSON.stringify(input);
  }
  return AWS.Lambda.invoke(parameters);
};
exports.invokeLambda = invokeLambda = function (name, input) {
  return _invokeLambda(name, false, input);
};
exports.syncInvokeLambda = syncInvokeLambda = function (name, input) {
  return _invokeLambda(name, true, input);
};
exports.listSources = listSources = async function (name) {
  var EventSourceMappings, NextMarker, next, result, results;
  results = [];
  next = void 0;
  while (true) {
    result = await AWS.Lambda.listEventSourceMappings({
      FunctionName: name,
      Marker: next
    });
    ({
      EventSourceMappings,
      NextMarker
    } = result);
    next = NextMarker;
    results.push(...EventSourceMappings);
    if (next == null) {
      return results;
    }
  }
};
exports.deleteSource = deleteSource = async function (source) {
  return await AWS.Lambda.deleteEventSourceMapping({
    UUID: source.UUID
  });
};
exports.deleteSources = deleteSources = async function (name) {
  var i, len, results1, source, sources;
  sources = await listSources(name);
  results1 = [];
  for (i = 0, len = sources.length; i < len; i++) {
    source = sources[i];
    results1.push(await deleteSource(source));
  }
  return results1;
};
_createSource = async function (source) {
  return await AWS.Lambda.createEventSourceMapping(source);
};
exports.createSource = createSource = async function (source, duration = 125) {
  try {
    return await _createSource(source);
  } catch (error1) {
    duration *= 2;
    await Time.sleep(duration);
    return await createSource(source, duration);
  }
};
exports.createSources = createSources = async function (sources) {
  var i, len, results1, source;
  results1 = [];
  for (i = 0, len = sources.length; i < len; i++) {
    source = sources[i];
    results1.push(await createSource(source));
  }
  return results1;
};
exports.putSources = putSources = async function (name, sources) {
  await deleteSources(name);
  return await createSources(sources);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9sYW1iZGEuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUEsT0FBQSxHQUFBLHNCQUFBLENBQUEsT0FBQTtBQUNBLElBQUEsTUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQTtBQUNBLElBQUEsRUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQTtBQUNBLElBQUEsSUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQTtBQUNBLElBQUEsSUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQTtBQUFBLElBQUEsUUFBQSxHQUFBLE9BQUE7QUFBQSxTQUFBLHlCQUFBLFdBQUEsZUFBQSxPQUFBLGtDQUFBLGlCQUFBLE9BQUEsT0FBQSxRQUFBLGdCQUFBLE9BQUEsT0FBQSxZQUFBLHdCQUFBLFlBQUEsQ0FBQSxXQUFBLFdBQUEsV0FBQSxHQUFBLGdCQUFBLEdBQUEsaUJBQUEsS0FBQSxXQUFBO0FBQUEsU0FBQSx3QkFBQSxHQUFBLEVBQUEsV0FBQSxTQUFBLFdBQUEsSUFBQSxHQUFBLElBQUEsR0FBQSxDQUFBLFVBQUEsV0FBQSxHQUFBLFFBQUEsR0FBQSxvQkFBQSxHQUFBLHdCQUFBLEdBQUEsNEJBQUEsT0FBQSxFQUFBLEdBQUEsVUFBQSxLQUFBLEdBQUEsd0JBQUEsQ0FBQSxXQUFBLE9BQUEsS0FBQSxJQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsR0FBQSxZQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsR0FBQSxTQUFBLE1BQUEsV0FBQSxxQkFBQSxHQUFBLE1BQUEsQ0FBQSxjQUFBLElBQUEsTUFBQSxDQUFBLHdCQUFBLFdBQUEsR0FBQSxJQUFBLEdBQUEsUUFBQSxHQUFBLGtCQUFBLE1BQUEsQ0FBQSxTQUFBLENBQUEsY0FBQSxDQUFBLElBQUEsQ0FBQSxHQUFBLEVBQUEsR0FBQSxTQUFBLElBQUEsR0FBQSxxQkFBQSxHQUFBLE1BQUEsQ0FBQSx3QkFBQSxDQUFBLEdBQUEsRUFBQSxHQUFBLGNBQUEsSUFBQSxLQUFBLElBQUEsQ0FBQSxHQUFBLElBQUEsSUFBQSxDQUFBLEdBQUEsS0FBQSxNQUFBLENBQUEsY0FBQSxDQUFBLE1BQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxZQUFBLE1BQUEsQ0FBQSxHQUFBLElBQUEsR0FBQSxDQUFBLEdBQUEsU0FBQSxNQUFBLENBQUEsT0FBQSxHQUFBLEdBQUEsTUFBQSxLQUFBLElBQUEsS0FBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLEVBQUEsTUFBQSxZQUFBLE1BQUE7QUFBQSxTQUFBLHVCQUFBLEdBQUEsV0FBQSxHQUFBLElBQUEsR0FBQSxDQUFBLFVBQUEsR0FBQSxHQUFBLEtBQUEsT0FBQSxFQUFBLEdBQUE7QUFKQSxJQUFBLEdBQUEsRUFBQSxhQUFBLEVBQUEsYUFBQSxFQUFBLFlBQUEsRUFBQSxhQUFBLEVBQUEsUUFBQSxFQUFBLFlBQUEsRUFBQSxZQUFBLEVBQUEsYUFBQSxFQUFBLFNBQUEsRUFBQSxZQUFBLEVBQUEsdUJBQUEsRUFBQSxnQkFBQSxFQUFBLGVBQUEsRUFBQSxrQkFBQSxFQUFBLFNBQUEsRUFBQSxZQUFBLEVBQUEsV0FBQSxFQUFBLEdBQUEsRUFBQSxhQUFBLEVBQUEsVUFBQSxFQUFBLGdCQUFBLEVBQUEsYUFBQSxFQUFBLFlBQUE7QUFBQSxPQUFBLENBQUEsWUFBQSxHQUFBLFlBQUE7QUFBQSxPQUFBLENBQUEsYUFBQSxHQUFBLGFBQUE7QUFBQSxPQUFBLENBQUEsZ0JBQUEsR0FBQSxnQkFBQTtBQUFBLE9BQUEsQ0FBQSxVQUFBLEdBQUEsVUFBQTtBQUFBLE9BQUEsQ0FBQSxhQUFBLEdBQUEsYUFBQTtBQUFBLE9BQUEsQ0FBQSxXQUFBLEdBQUEsV0FBQTtBQUFBLE9BQUEsQ0FBQSxZQUFBLEdBQUEsWUFBQTtBQUFBLE9BQUEsQ0FBQSxTQUFBLEdBQUEsU0FBQTtBQUFBLE9BQUEsQ0FBQSxrQkFBQSxHQUFBLGtCQUFBO0FBQUEsT0FBQSxDQUFBLGVBQUEsR0FBQSxlQUFBO0FBQUEsT0FBQSxDQUFBLGdCQUFBLEdBQUEsZ0JBQUE7QUFBQSxPQUFBLENBQUEsdUJBQUEsR0FBQSx1QkFBQTtB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QUFNLGFBQUEsQ0FBYyxNQUFkLENBRFI7R0FFQSxDQUFBLE9BQUEsTUFBQSxFQUFBO0lBQ0UsUUFBQSxJQUFZLENBQUE7SUFDWixNQUFNLElBQUksQ0FBQyxLQUFMLENBQVcsUUFBWCxDQUFBO0lBQ04sT0FBQSxNQUFNLFlBQUEsQ0FBYSxNQUFiLEVBQXFCLFFBQXJCLENBSFI7O0FBSGEsQ0FBQTtBQVFmLE9BQUEsQ0FBQSxhQUFBLEdBQUEsYUFBQSxHQUFnQixlQUFBLENBQUMsT0FBRCxFQUFBO0VBQ2hCLElBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxRQUFBLEVBQUEsTUFBQTtFQUFFLFFBQUEsR0FBQSxFQUFBO0VBQUEsS0FBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLEdBQUEsR0FBQSxPQUFBLENBQUEsTUFBQSxFQUFBLENBQUEsR0FBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUE7O2lCQUNFLENBQUEsTUFBTSxZQUFBLENBQWEsTUFBYixDQUFOLENBQUE7RUFERjs7QUFEYyxDQUFBO0FBSWhCLE9BQUEsQ0FBQSxVQUFBLEdBQUEsVUFBQSxHQUFhLGVBQUEsQ0FBQyxJQUFELEVBQU8sT0FBUCxFQUFBO0VBQ1gsTUFBTSxhQUFBLENBQWMsSUFBZCxDQUFBO0VBQ04sT0FBQSxNQUFNLGFBQUEsQ0FBYyxPQUFkLENBQU47QUFGVyxDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENyeXB0byBmcm9tIFwiY3J5cHRvXCJcbmltcG9ydCAqIGFzIExhbWJkYSBmcm9tIFwiQGF3cy1zZGsvY2xpZW50LWxhbWJkYVwiXG5pbXBvcnQgKiBhcyBTMyBmcm9tIFwiQGF3cy1zZGsvY2xpZW50LXMzXCJcbmltcG9ydCAqIGFzIFRleHQgZnJvbSBcIkBkYXNoa2l0ZS9qb3kvdGV4dFwiXG5pbXBvcnQgKiBhcyBUaW1lIGZyb20gXCJAZGFzaGtpdGUvam95L3RpbWVcIlxuaW1wb3J0IHsgbGlmdCB9IGZyb20gXCIuL2hlbHBlcnNcIlxuXG5BV1MgPVxuICBMYW1iZGE6IGxpZnQgTGFtYmRhXG4gIFMzOiBsaWZ0IFMzXG5cbm1kNSA9IChidWZmZXIpIC0+XG4gIENyeXB0by5jcmVhdGVIYXNoKCdtZDUnKS51cGRhdGUoYnVmZmVyKS5kaWdlc3QoXCJiYXNlNjRcIilcblxuaGFzTGFtYmRhID0gKG5hbWUpIC0+IChhd2FpdCBnZXRMYW1iZGEgbmFtZSk/XG5cbmdldExhbWJkYSA9IChuYW1lKSAtPlxuICB0cnlcbiAgICBsYW1iZGEgPSBhd2FpdCBBV1MuTGFtYmRhLmdldEZ1bmN0aW9uIEZ1bmN0aW9uTmFtZTogbmFtZVxuICAgIF86IGxhbWJkYVxuICAgIGFybjogbGFtYmRhLkNvbmZpZ3VyYXRpb24uRnVuY3Rpb25Bcm5cbiAgICBzdGF0ZTogbGFtYmRhLkNvbmZpZ3VyYXRpb24uU3RhdGVcbiAgICBsYXN0U3RhdHVzOiBsYW1iZGEuQ29uZmlndXJhdGlvbi5MYXN0VXBkYXRlU3RhdHVzXG4gIGNhdGNoIGVycm9yXG4gICAgaWYgL1Jlc291cmNlTm90Rm91bmRFeGNlcHRpb24vLnRlc3QgZXJyb3IudG9TdHJpbmcoKVxuICAgICAgdW5kZWZpbmVkXG4gICAgZWxzZVxuICAgICAgdGhyb3cgZXJyb3JcblxuIyBBV1MgYWRkZWQgaW50ZXJuYWwgc3RhdGUgbWFuYWdlbWVudCB0byBMYW1iZGEgaW4gYW4gZWZmb3J0IHRvIGltcHJvdmUgdGhlIHBlcmZvcm1hbmNlXG4jIG9mIHRoZSBpbnZvY2F0aW9uIGN5Y2xlLiBUaGlzIGlzIGEgYnJvYWQgaGVscGVyIHRvIHdhaXQgdW50aWwgdGhlIGxhbWJkYSBpcyByZWFkeVxuIyB0byBnbyBhbmQgYWNjZXB0IG1vcmUgY2hhbmdlcyB0byBpdHMgc3RhdGUuXG53YWl0Rm9yUmVhZHkgPSAobmFtZSkgLT5cbiAgbG9vcFxuICAgIHsgc3RhdGUsIGxhc3RTdGF0dXMgfSA9IGF3YWl0IGdldExhbWJkYSBuYW1lXG4gICAgaWYgKCBzdGF0ZSA9PSBcIkFjdGl2ZVwiICkgJiYgKCBsYXN0U3RhdHVzID09IFwiU3VjY2Vzc2Z1bFwiIClcbiAgICAgIGJyZWFrXG4gICAgZWxzZSBpZiBzdGF0ZSA9PSBcIkZhaWxlZFwiXG4gICAgICB0aHJvdyBuZXcgRXJyb3IgXCJMYW1iZGEgWyAje25hbWV9IF0gU3RhdGUgaXMgRmFpbGVkLlwiXG4gICAgZWxzZSBpZiBsYXN0U3RhdHVzID09IFwiRmFpbGVkXCJcbiAgICAgIHRocm93IG5ldyBFcnJvciBcIkxhbWJkYSBbICN7bmFtZX0gXSBMYXN0VXBkYXRlU3RhdHVzIGlzIEZhaWxlZC5cIlxuICAgIGVsc2VcbiAgICAgIGF3YWl0IFRpbWUuc2xlZXAgMTAwMFxuXG5nZXRMYW1iZGFWZXJzaW9uID0gKG5hbWUsIHZlcnNpb24pIC0+XG4gIHsgVmVyc2lvbnMgfSAgPSBhd2FpdCBBV1MuTGFtYmRhLmxpc3RWZXJzaW9uc0J5RnVuY3Rpb24gRnVuY3Rpb25OYW1lOiBuYW1lXG4gIGZvciBjdXJyZW50IGluIFZlcnNpb25zXG4gICAgaWYgdmVyc2lvbiA9PSBUZXh0LnBhcnNlTnVtYmVyIGN1cnJlbnQuVmVyc2lvblxuICAgICAgcmV0dXJuXG4gICAgICAgIF86IGN1cnJlbnRcbiAgICAgICAgYXJuOiBjdXJyZW50LkZ1bmN0aW9uQXJuXG4gICAgICAgIHZlcnNpb246IFRleHQucGFyc2VOdW1iZXIgY3VycmVudFZlcnNpb25cbiAgdW5kZWZpbmVkXG5cbmdldExhdGVzdExhbWJkYSA9IChuYW1lKSAtPlxuICB7IFZlcnNpb25zIH0gID0gYXdhaXQgQVdTLkxhbWJkYS5saXN0VmVyc2lvbnNCeUZ1bmN0aW9uIEZ1bmN0aW9uTmFtZTogbmFtZVxuICByZXN1bHQgPSB1bmRlZmluZWRcbiAgbWF4ID0gMFxuICBmb3IgY3VycmVudCBpbiBWZXJzaW9uc1xuICAgIGlmIGN1cnJlbnQuVmVyc2lvbiAhPSBcIiRMQVRFU1RcIlxuICAgICAgdmVyc2lvbiA9IFRleHQucGFyc2VOdW1iZXIgY3VycmVudC5WZXJzaW9uXG4gICAgICBpZiB2ZXJzaW9uID49IG1heFxuICAgICAgICBtYXggPSB2ZXJzaW9uXG4gICAgICAgIHJlc3VsdCA9IGN1cnJlbnRcbiAgICBlbHNlXG4gICAgICByZXN1bHQgPSBjdXJyZW50XG4gIGlmIHJlc3VsdD9cbiAgICBfOiByZXN1bHRcbiAgICBhcm46IHJlc3VsdC5GdW5jdGlvbkFyblxuICAgIHZlcnNpb246IG1heFxuXG5nZXRMYXRlc3RMYW1iZGFBUk4gPSAobmFtZSkgLT4gKCBhd2FpdCBnZXRMYXRlc3RMYW1iZGEgbmFtZSApLmFyblxuXG5nZXRMYW1iZGFBUk4gPSBnZXRMYXRlc3RMYW1iZGFBUk5cblxuZ2V0TGFtYmRhVW5xdWFsaWZpZWRBUk4gPSAobmFtZSkgLT5cbiAgKCAoICggYXdhaXQgZ2V0TGFtYmRhQVJOIG5hbWUgKS5zcGxpdCBcIjpcIiApWy4uLTJdICkuam9pbiBcIjpcIlxuXG5kZWZhdWx0cyA9XG4gIGJ1Y2tldDogXCJkb2xvcmVzLmRhc2hraXRlLmNvbVwiXG4gIHJvbGU6IFwiYXJuOmF3czppYW06OmF3czpwb2xpY3kvc2VydmljZS1yb2xlL0FXU0xhbWJkYUJhc2ljRXhlY3V0aW9uUm9sZVwiXG4gIG1lbW9yeTogMTI4ICMgbWF4IHNpemUgZm9yIGVkZ2UgbGFtYmRhc1xuICB0aW1lb3V0OiA1ICMgbWF4IHRpbWVvdXQgZm9yIGVkZ2UgbGFtYmRhc1xuICBoYW5kbGVyOiBcImJ1aWxkL2xhbWJkYS9pbmRleC5oYW5kbGVyXCJcbiAgcnVudGltZTogXCJub2RlanMxOC54XCJcblxucHVibGlzaExhbWJkYSA9IChuYW1lLCBkYXRhLCBjb25maWd1cmF0aW9uKSAtPlxuXG4gIHsgXG4gICAgcm9sZVxuICAgIGhhbmRsZXJcbiAgICBydW50aW1lXG4gICAgYnVja2V0XG4gICAgbWVtb3J5XG4gICAgdGltZW91dFxuICAgIGVudmlyb25tZW50XG4gIH0gPSB7IGRlZmF1bHRzLi4uLCBjb25maWd1cmF0aW9uLi4uIH1cblxuICBfY29uZmlndXJhdGlvbiA9XG4gICAgRnVuY3Rpb25OYW1lOiBuYW1lXG4gICAgSGFuZGxlcjogaGFuZGxlclxuICAgIFJ1bnRpbWU6IHJ1bnRpbWVcbiAgICBNZW1vcnlTaXplOiBtZW1vcnlcbiAgICBUaW1lb3V0OiB0aW1lb3V0XG4gICAgVHJhY2luZ0NvbmZpZzogTW9kZTogXCJQYXNzVGhyb3VnaFwiXG4gICAgUm9sZTogcm9sZVxuXG4gICMgaWYgZW52aXJvbm1lbnQ/XG4gICMgICBfY29uZmlndXJhdGlvbi5FbnZpcm9ubWVudCA9IFZhcmlhYmxlczogZW52aXJvbm1lbnRcblxuICBpZiBhd2FpdCBoYXNMYW1iZGEgbmFtZVxuXG4gICAgYXdhaXQgQVdTLkxhbWJkYS51cGRhdGVGdW5jdGlvbkNvZGVcbiAgICAgIEZ1bmN0aW9uTmFtZTogbmFtZVxuICAgICAgUHVibGlzaDogZmFsc2VcbiAgICAgIFppcEZpbGU6IGRhdGFcblxuICAgIGF3YWl0IHdhaXRGb3JSZWFkeSBuYW1lXG4gICAgXG4gICAgYXdhaXQgQVdTLkxhbWJkYS51cGRhdGVGdW5jdGlvbkNvbmZpZ3VyYXRpb24gX2NvbmZpZ3VyYXRpb25cblxuICAgIHdhaXRGb3JSZWFkeSBuYW1lXG5cbiAgZWxzZVxuXG4gICAgYXdhaXQgQVdTLkxhbWJkYS5jcmVhdGVGdW5jdGlvbiB7XG4gICAgICBfY29uZmlndXJhdGlvbi4uLlxuICAgICAgQ29kZTogWmlwRmlsZTogZGF0YVxuICAgIH1cblxuICAgIHdhaXRGb3JSZWFkeSBuYW1lXG5cbnZlcnNpb25MYW1iZGEgPSAobmFtZSkgLT5cbiAgcmVzdWx0ID0gYXdhaXQgQVdTLkxhbWJkYS5wdWJsaXNoVmVyc2lvbiBGdW5jdGlvbk5hbWU6IG5hbWVcbiAgXzogcmVzdWx0XG4gIGFybjogcmVzdWx0LkZ1bmN0aW9uQXJuXG4gIHZlcnNpb246IFRleHQucGFyc2VOdW1iZXIgcmVzdWx0LlZlcnNpb25cblxuZGVsZXRlTGFtYmRhID0gKG5hbWUpIC0+XG4gIEFXUy5MYW1iZGEuZGVsZXRlRnVuY3Rpb24gRnVuY3Rpb25OYW1lOiBuYW1lXG5cbl9pbnZva2VMYW1iZGEgPSAobmFtZSwgc3luYywgaW5wdXQpIC0+XG4gIHBhcmFtZXRlcnMgPSBGdW5jdGlvbk5hbWU6IG5hbWVcbiAgcGFyYW1ldGVycy5JbnZvY2F0aW9uVHlwZSA9IGlmIHN5bmMgdGhlbiBcIlJlcXVlc3RSZXNwb25zZVwiIGVsc2UgXCJFdmVudFwiXG5cbiAgaWYgaW5wdXQ/XG4gICAgcGFyYW1ldGVycy5QYXlsb2FkID0gSlNPTi5zdHJpbmdpZnkgaW5wdXRcblxuXG4gIEFXUy5MYW1iZGEuaW52b2tlIHBhcmFtZXRlcnNcblxuaW52b2tlTGFtYmRhID0gKG5hbWUsIGlucHV0KSAtPiBfaW52b2tlTGFtYmRhIG5hbWUsIGZhbHNlLCBpbnB1dFxuc3luY0ludm9rZUxhbWJkYSA9IChuYW1lLCBpbnB1dCkgLT4gX2ludm9rZUxhbWJkYSBuYW1lLCB0cnVlLCBpbnB1dFxuXG5saXN0U291cmNlcyA9IChuYW1lKSAtPlxuICByZXN1bHRzID0gW11cbiAgbmV4dCA9IHVuZGVmaW5lZFxuICB3aGlsZSB0cnVlXG4gICAgcmVzdWx0ID0gYXdhaXQgQVdTLkxhbWJkYS5saXN0RXZlbnRTb3VyY2VNYXBwaW5nc1xuICAgICAgRnVuY3Rpb25OYW1lOiBuYW1lXG4gICAgICBNYXJrZXI6IG5leHRcblxuICAgIHsgRXZlbnRTb3VyY2VNYXBwaW5ncywgTmV4dE1hcmtlciB9ID0gcmVzdWx0XG5cbiAgICBuZXh0ID0gTmV4dE1hcmtlclxuICAgIHJlc3VsdHMucHVzaCBFdmVudFNvdXJjZU1hcHBpbmdzLi4uXG4gICAgaWYgIW5leHQ/XG4gICAgICByZXR1cm4gcmVzdWx0c1xuXG5kZWxldGVTb3VyY2UgPSAoc291cmNlKSAtPlxuICBhd2FpdCBBV1MuTGFtYmRhLmRlbGV0ZUV2ZW50U291cmNlTWFwcGluZyBVVUlEOiBzb3VyY2UuVVVJRFxuXG5kZWxldGVTb3VyY2VzID0gKG5hbWUpIC0+XG4gIHNvdXJjZXMgPSBhd2FpdCBsaXN0U291cmNlcyBuYW1lXG4gIGZvciBzb3VyY2UgaW4gc291cmNlc1xuICAgIGF3YWl0IGRlbGV0ZVNvdXJjZSBzb3VyY2VcblxuX2NyZWF0ZVNvdXJjZSA9IChzb3VyY2UpIC0+XG4gIGF3YWl0IEFXUy5MYW1iZGEuY3JlYXRlRXZlbnRTb3VyY2VNYXBwaW5nIHNvdXJjZVxuXG5jcmVhdGVTb3VyY2UgPSAoc291cmNlLCBkdXJhdGlvbiA9IDEyNSkgLT5cbiAgdHJ5XG4gICAgYXdhaXQgX2NyZWF0ZVNvdXJjZSBzb3VyY2VcbiAgY2F0Y2hcbiAgICBkdXJhdGlvbiAqPSAyXG4gICAgYXdhaXQgVGltZS5zbGVlcCBkdXJhdGlvblxuICAgIGF3YWl0IGNyZWF0ZVNvdXJjZSBzb3VyY2UsIGR1cmF0aW9uXG5cbmNyZWF0ZVNvdXJjZXMgPSAoc291cmNlcykgLT5cbiAgZm9yIHNvdXJjZSBpbiBzb3VyY2VzXG4gICAgYXdhaXQgY3JlYXRlU291cmNlIHNvdXJjZVxuXG5wdXRTb3VyY2VzID0gKG5hbWUsIHNvdXJjZXMpIC0+XG4gIGF3YWl0IGRlbGV0ZVNvdXJjZXMgbmFtZVxuICBhd2FpdCBjcmVhdGVTb3VyY2VzIHNvdXJjZXNcbiAgXG5cbmV4cG9ydCB7XG4gIGhhc0xhbWJkYVxuICBnZXRMYW1iZGFcbiAgd2FpdEZvclJlYWR5XG4gIGdldExhbWJkYVZlcnNpb25cbiAgZ2V0TGF0ZXN0TGFtYmRhXG4gIGdldExhdGVzdExhbWJkYUFSTlxuICBnZXRMYW1iZGFBUk5cbiAgZ2V0TGFtYmRhVW5xdWFsaWZpZWRBUk5cbiAgcHVibGlzaExhbWJkYVxuICB2ZXJzaW9uTGFtYmRhXG4gIGRlbGV0ZUxhbWJkYVxuICBpbnZva2VMYW1iZGFcbiAgc3luY0ludm9rZUxhbWJkYVxuICBsaXN0U291cmNlc1xuICBkZWxldGVTb3VyY2VzXG4gIGRlbGV0ZVNvdXJjZVxuICBjcmVhdGVTb3VyY2VzXG4gIGNyZWF0ZVNvdXJjZVxuICBwdXRTb3VyY2VzXG59XG4iXSwic291cmNlUm9vdCI6IiJ9
//# sourceURL=src/lambda.coffee