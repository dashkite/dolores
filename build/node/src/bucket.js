"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.streamObject = exports.putObject = exports.putBucketWebsite = exports.putBucketRedirect = exports.putBucketLifecycle = exports.putBucket = exports.listObjects = exports.headObject = exports.hasObject = exports.hasBucket = exports.getObject = exports.getBucketLifecycle = exports.getBucketARN = exports.emptyBucket = exports.deleteObjects = exports.deleteObject = exports.deleteDirectory = exports.deleteBucketWebsite = exports.deleteBucketLifecycle = exports.deleteBucket = void 0;
var S3 = _interopRequireWildcard(require("@aws-sdk/client-s3"));
var _helpers = require("./helpers.js");
var _generic = require("@dashkite/joy/generic");
var _type = require("@dashkite/joy/type");
function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }
function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }
var AWS, deleteBucket, deleteBucketLifecycle, deleteBucketWebsite, deleteDirectory, deleteObject, deleteObjects, emptyBucket, getBucketARN, getBucketLifecycle, getObject, hasBucket, hasObject, headObject, isS3Object, listObjects, putBucket, putBucketLifecycle, putBucketRedirect, putBucketWebsite, putObject, rescueNotFound, streamObject;
exports.streamObject = streamObject;
exports.putObject = putObject;
exports.putBucketWebsite = putBucketWebsite;
exports.putBucketRedirect = putBucketRedirect;
exports.putBucketLifecycle = putBucketLifecycle;
exports.putBucket = putBucket;
exports.listObjects = listObjects;
exports.headObject = headObject;
exports.hasObject = hasObject;
exports.hasBucket = hasBucket;
exports.getObject = getObject;
exports.getBucketLifecycle = getBucketLifecycle;
exports.getBucketARN = getBucketARN;
exports.emptyBucket = emptyBucket;
exports.deleteObjects = deleteObjects;
exports.deleteObject = deleteObject;
exports.deleteDirectory = deleteDirectory;
exports.deleteBucketWebsite = deleteBucketWebsite;
exports.deleteBucketLifecycle = deleteBucketLifecycle;
exports.deleteBucket = deleteBucket;
AWS = {
  S3: (0, _helpers.lift)(S3)
};
rescueNotFound = function (error) {
  var code, ref, ref1;
  code = (ref = error != null ? (ref1 = error.$response) != null ? ref1.statusCode : void 0 : void 0) != null ? ref : error.$metadata.httpStatusCode;
  if (!(code === 403 || code === 404)) {
    throw error;
  }
};
exports.hasBucket = hasBucket = async function (name) {
  var error;
  try {
    await AWS.S3.headBucket({
      Bucket: name
    });
    return true;
  } catch (error1) {
    error = error1;
    rescueNotFound(error);
    return false;
  }
};
exports.getBucketARN = getBucketARN = function (name) {
  return `arn:aws:s3:::${name}`;
};
exports.putBucket = putBucket = async function (name) {
  if (!(await hasBucket(name))) {
    return await AWS.S3.createBucket({
      Bucket: name
    });
  }
};
exports.deleteBucket = deleteBucket = async function (name) {
  if (await hasBucket(name)) {
    return await AWS.S3.deleteBucket({
      Bucket: name
    });
  }
};
exports.getBucketLifecycle = getBucketLifecycle = async function (name) {
  return await AWS.S3.getBucketLifecycleConfiguration({
    Bucket: name
  });
};
exports.putBucketLifecycle = putBucketLifecycle = async function (name, lifecycle) {
  return await AWS.S3.putBucketLifecycleConfiguration({
    Bucket: name,
    LifecycleConfiguration: lifecycle
  });
};
exports.deleteBucketLifecycle = deleteBucketLifecycle = async function (name) {
  return await AWS.S3.deleteBucketLifecycle({
    Bucket: name
  });
};
exports.putBucketWebsite = putBucketWebsite = function (name, {
  index,
  error
}) {
  return AWS.S3.putBucketWebsite({
    Bucket: name,
    WebsiteConfiguration: {
      IndexDocument: {
        Suffix: index
      },
      ErrorDocument: {
        Key: error
      }
    }
  });
};
exports.putBucketRedirect = putBucketRedirect = function (name, target) {
  return AWS.S3.putBucketWebsite({
    Bucket: name,
    WebsiteConfiguration: {
      RedirectAllRequestsTo: {
        HostName: target
      }
    }
  });
};
exports.deleteBucketWebsite = deleteBucketWebsite = function (name) {
  return AWS.S3.deleteBucketWebsite({
    Bucket: name
  });
};
exports.headObject = headObject = async function (name, key) {
  var error;
  try {
    return await AWS.S3.headObject({
      Bucket: name,
      Key: key
    });
  } catch (error1) {
    error = error1;
    rescueNotFound(error);
    return null;
  }
};
exports.hasObject = hasObject = async function (name, key) {
  if ((await headObject(name, key)) != null) {
    return true;
  } else {
    return false;
  }
};
exports.getObject = getObject = async function (name, key) {
  var error;
  try {
    return await AWS.S3.getObject({
      Bucket: name,
      Key: key
    });
  } catch (error1) {
    error = error1;
    rescueNotFound(error);
    return null;
  }
};
isS3Object = function (value) {
  return (0, _type.isObject)(value) && value.Body != null;
};
exports.streamObject = streamObject = (0, _generic.generic)({
  name: "streamObject"
});
(0, _generic.generic)(streamObject, isS3Object, _type.isString, function ({
  Body
}, encoding) {
  if (encoding === "binary") {
    return Body;
  } else {
    return new Promise(function (resolve, reject) {
      var output;
      Body.setEncoding(encoding);
      output = "";
      Body.on("data", function (chunk) {
        return output += chunk;
      });
      Body.on("error", function (error) {
        return reject(error);
      });
      return Body.on("end", function () {
        return resolve(output);
      });
    });
  }
});
(0, _generic.generic)(streamObject, isS3Object, function (object) {
  return streamObject(object, "utf8");
});
(0, _generic.generic)(streamObject, _type.isString, _type.isString, _type.isString, async function (name, key, encoding) {
  return streamObject(await getObject(name, key), encoding);
});
(0, _generic.generic)(streamObject, _type.isString, _type.isString, async function (name, key) {
  return streamObject(await getObject(name, key));
});
exports.putObject = putObject = function (parameters) {
  return AWS.S3.putObject(parameters);
};
exports.deleteObject = deleteObject = async function (name, key) {
  if (await hasObject(name, key)) {
    return await AWS.S3.deleteObject({
      Bucket: name,
      Key: key
    });
  }
};
exports.deleteObjects = deleteObjects = async function (name, keys) {
  var key;
  return await AWS.S3.deleteObjects({
    Bucket: name,
    Delete: {
      Objects: function () {
        var i, len, results;
        results = [];
        for (i = 0, len = keys.length; i < len; i++) {
          key = keys[i];
          results.push({
            Key: key
          });
        }
        return results;
      }(),
      Quiet: true
    }
  });
};
exports.listObjects = listObjects = async function (name, prefix, items = [], token) {
  var Contents, IsTruncated, NextContinuationToken, parameters;
  parameters = {
    Bucket: name,
    MaxKeys: 1000
  };
  if (token != null) {
    parameters.ContinuationToken = token;
  }
  if (prefix != null) {
    parameters.Prefix = prefix;
  }
  ({
    IsTruncated,
    Contents,
    NextContinuationToken
  } = await AWS.S3.listObjectsV2(parameters));
  if (IsTruncated) {
    items = items.concat(Contents);
    return await listObjects(name, prefix, items, NextContinuationToken);
  } else {
    return items.concat(Contents);
  }
};
exports.deleteDirectory = deleteDirectory = async function (name, prefix) {
  var batch, i, keys, len, object, ref, ref1, results;
  keys = [];
  ref = await listObjects(name, prefix);
  for (i = 0, len = ref.length; i < len; i++) {
    object = ref[i];
    keys.push(object.Key);
  }
  ref1 = (0, _helpers.partition)(1000, keys);
  results = [];
  for (batch of ref1) {
    if (batch.length > 0) {
      // Is this neccessary?
      results.push(await deleteObjects(name, batch));
    } else {
      results.push(void 0);
    }
  }
  return results;
};
exports.emptyBucket = emptyBucket = function (name) {
  return deleteDirectory(name);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9idWNrZXQuY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUEsRUFBQSxHQUFBLHVCQUFBLENBQUEsT0FBQTtBQUFBLElBQUEsUUFBQSxHQUFBLE9BQUE7QUFFQSxJQUFBLFFBQUEsR0FBQSxPQUFBO0FBQ0EsSUFBQSxLQUFBLEdBQUEsT0FBQTtBQUFBLFNBQUEseUJBQUEsV0FBQSxlQUFBLE9BQUEsa0NBQUEsaUJBQUEsT0FBQSxPQUFBLFFBQUEsZ0JBQUEsT0FBQSxPQUFBLFlBQUEsd0JBQUEsWUFBQSxDQUFBLFdBQUEsV0FBQSxXQUFBLEdBQUEsZ0JBQUEsR0FBQSxpQkFBQSxLQUFBLFdBQUE7QUFBQSxTQUFBLHdCQUFBLEdBQUEsRUFBQSxXQUFBLFNBQUEsV0FBQSxJQUFBLEdBQUEsSUFBQSxHQUFBLENBQUEsVUFBQSxXQUFBLEdBQUEsUUFBQSxHQUFBLG9CQUFBLEdBQUEsd0JBQUEsR0FBQSw0QkFBQSxPQUFBLEVBQUEsR0FBQSxVQUFBLEtBQUEsR0FBQSx3QkFBQSxDQUFBLFdBQUEsT0FBQSxLQUFBLElBQUEsS0FBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLFlBQUEsS0FBQSxDQUFBLEdBQUEsQ0FBQSxHQUFBLFNBQUEsTUFBQSxXQUFBLHFCQUFBLEdBQUEsTUFBQSxDQUFBLGNBQUEsSUFBQSxNQUFBLENBQUEsd0JBQUEsV0FBQSxHQUFBLElBQUEsR0FBQSxRQUFBLEdBQUEsa0JBQUEsTUFBQSxDQUFBLFNBQUEsQ0FBQSxjQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsRUFBQSxHQUFBLFNBQUEsSUFBQSxHQUFBLHFCQUFBLEdBQUEsTUFBQSxDQUFBLHdCQUFBLENBQUEsR0FBQSxFQUFBLEdBQUEsY0FBQSxJQUFBLEtBQUEsSUFBQSxDQUFBLEdBQUEsSUFBQSxJQUFBLENBQUEsR0FBQSxLQUFBLE1BQUEsQ0FBQSxjQUFBLENBQUEsTUFBQSxFQUFBLEdBQUEsRUFBQSxJQUFBLFlBQUEsTUFBQSxDQUFBLEdBQUEsSUFBQSxHQUFBLENBQUEsR0FBQSxTQUFBLE1BQUEsQ0FBQSxPQUFBLEdBQUEsR0FBQSxNQUFBLEtBQUEsSUFBQSxLQUFBLENBQUEsR0FBQSxDQUFBLEdBQUEsRUFBQSxNQUFBLFlBQUEsTUFBQTtBQUhBLElBQUEsR0FBQSxFQUFBLFlBQUEsRUFBQSxxQkFBQSxFQUFBLG1CQUFBLEVBQUEsZUFBQSxFQUFBLFlBQUEsRUFBQSxhQUFBLEVBQUEsV0FBQSxFQUFBLFlBQUEsRUFBQSxrQkFBQSxFQUFBLFNBQUEsRUFBQSxTQUFBLEVBQUEsU0FBQSxFQUFBLFVBQUEsRUFBQSxVQUFBLEVBQUEsV0FBQSxFQUFBLFNBQUEsRUFBQSxrQkFBQSxFQUFBLGlCQUFBLEVBQUEsZ0JBQUEsRUFBQSxTQUFBLEVBQUEsY0FBQSxFQUFBLFlBQUE7QUFBQSxPQUFBLENBQUEsWUFBQSxHQUFBLFlBQUE7QUFBQSxPQUFBLENBQUEsU0FBQSxHQUFBLFNBQUE7QUFBQSxPQUFBLENBQUEsZ0JBQUEsR0FBQSxnQkFBQTtBQUFBLE9BQUEsQ0FBQSxpQkFBQSxHQUFBLGlCQUFBO0FBQUEsT0FBQSxDQUFBLGtCQUFBLEdBQUEsa0JBQUE7QUFBQSxPQUFBLENBQUEsU0FBQSxHQUFBLFNBQUE7QUFBQSxPQUFBLENBQUEsV0FBQSxHQUFBLFdBQUE7QUFBQSxPQUFBLENBQUEsVUFBQSxHQUFBLFVBQUE7QUFBQSxPQUFBLENBQUEsU0FBQSxHQUFBLFNBQUE7QUFBQSxPQUFBLENBQUEsU0FBQSxHQUFBLFNBQUE7QUFBQSxPQUFBLENBQUEsU0FBQSxHQUFBLFNBQUE7QUFBQSxPQUFBLENBQUEsa0JBQUEsR0FBQSxrQkFBQTtBQUFBLE9BQUEsQ0FBQSxZQUFBLEdBQUEsWUFBQTtBQUFBLE9BQUEsQ0FBQSxXQUFBLEdBQUEsV0FBQTtBQUFBLE9BQUEsQ0FBQSxhQUFBLEdBQUEsYUFBQTtBQUFBLE9BQUEsQ0FBQSxZQUFBLEdBQUEsWUFBQTtBQUFBLE9BQUEsQ0FBQSxlQUFBLEdBQUEsZUFBQTtBQUFBLE9BQUEsQ0FBQSxtQkFBQSxHQUFBLG1CQUFBO0FB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ImltcG9ydCAqIGFzIFMzIGZyb20gXCJAYXdzLXNkay9jbGllbnQtczNcIlxuaW1wb3J0IHsgbGlmdCwgcGFydGl0aW9uIH0gZnJvbSBcIi4vaGVscGVyc1wiXG5pbXBvcnQgeyBnZW5lcmljIH0gZnJvbSBcIkBkYXNoa2l0ZS9qb3kvZ2VuZXJpY1wiXG5pbXBvcnQgeyBpc1N0cmluZywgaXNPYmplY3QgfSBmcm9tIFwiQGRhc2hraXRlL2pveS90eXBlXCJcblxuXG5BV1MgPVxuICBTMzogbGlmdCBTM1xuXG5yZXNjdWVOb3RGb3VuZCA9IChlcnJvcikgLT5cbiAgY29kZSA9IGVycm9yPy4kcmVzcG9uc2U/LnN0YXR1c0NvZGUgPyBlcnJvci4kbWV0YWRhdGEuaHR0cFN0YXR1c0NvZGVcbiAgaWYgISAoIGNvZGUgaW4gWyA0MDMsIDQwNCBdIClcbiAgICB0aHJvdyBlcnJvclxuXG5oYXNCdWNrZXQgPSAobmFtZSkgLT5cbiAgdHJ5XG4gICAgYXdhaXQgQVdTLlMzLmhlYWRCdWNrZXQgQnVja2V0OiBuYW1lXG4gICAgdHJ1ZVxuICBjYXRjaCBlcnJvclxuICAgIHJlc2N1ZU5vdEZvdW5kIGVycm9yXG4gICAgZmFsc2VcblxuZ2V0QnVja2V0QVJOID0gKG5hbWUpIC0+XG4gIFwiYXJuOmF3czpzMzo6OiN7bmFtZX1cIlxuXG5wdXRCdWNrZXQgPSAobmFtZSkgLT5cbiAgaWYgISggYXdhaXQgaGFzQnVja2V0IG5hbWUgKVxuICAgIGF3YWl0IEFXUy5TMy5jcmVhdGVCdWNrZXQgQnVja2V0OiBuYW1lXG5cbmRlbGV0ZUJ1Y2tldCA9IChuYW1lKSAtPlxuICBpZiBhd2FpdCBoYXNCdWNrZXQgbmFtZVxuICAgIGF3YWl0IEFXUy5TMy5kZWxldGVCdWNrZXQgQnVja2V0OiBuYW1lXG5cbmdldEJ1Y2tldExpZmVjeWNsZSA9IChuYW1lKSAtPlxuICBhd2FpdCBBV1MuUzMuZ2V0QnVja2V0TGlmZWN5Y2xlQ29uZmlndXJhdGlvbiBCdWNrZXQ6IG5hbWVcblxucHV0QnVja2V0TGlmZWN5Y2xlID0gKG5hbWUsIGxpZmVjeWNsZSkgLT5cbiAgYXdhaXQgQVdTLlMzLnB1dEJ1Y2tldExpZmVjeWNsZUNvbmZpZ3VyYXRpb24gXG4gICAgQnVja2V0OiBuYW1lXG4gICAgTGlmZWN5Y2xlQ29uZmlndXJhdGlvbjogbGlmZWN5Y2xlXG5cbmRlbGV0ZUJ1Y2tldExpZmVjeWNsZSA9IChuYW1lKSAtPlxuICBhd2FpdCBBV1MuUzMuZGVsZXRlQnVja2V0TGlmZWN5Y2xlIEJ1Y2tldDogbmFtZVxuXG5wdXRCdWNrZXRXZWJzaXRlID0gKCBuYW1lLCB7IGluZGV4LCBlcnJvciB9KSAtPlxuICBBV1MuUzMucHV0QnVja2V0V2Vic2l0ZVxuICAgIEJ1Y2tldDogbmFtZVxuICAgIFdlYnNpdGVDb25maWd1cmF0aW9uOlxuICAgICAgSW5kZXhEb2N1bWVudDogU3VmZml4OiBpbmRleFxuICAgICAgRXJyb3JEb2N1bWVudDogS2V5OiBlcnJvclxuXG5wdXRCdWNrZXRSZWRpcmVjdCA9ICggbmFtZSwgdGFyZ2V0ICkgLT5cbiAgQVdTLlMzLnB1dEJ1Y2tldFdlYnNpdGVcbiAgICBCdWNrZXQ6IG5hbWVcbiAgICBXZWJzaXRlQ29uZmlndXJhdGlvbjpcbiAgICAgIFJlZGlyZWN0QWxsUmVxdWVzdHNUbzpcbiAgICAgICAgSG9zdE5hbWU6IHRhcmdldFxuXG5kZWxldGVCdWNrZXRXZWJzaXRlID0gKCBuYW1lICkgLT5cbiAgQVdTLlMzLmRlbGV0ZUJ1Y2tldFdlYnNpdGUgQnVja2V0OiBuYW1lXG5cblxuaGVhZE9iamVjdCA9IChuYW1lLCBrZXkpIC0+XG4gIHRyeVxuICAgIGF3YWl0IEFXUy5TMy5oZWFkT2JqZWN0IEJ1Y2tldDogbmFtZSwgS2V5OiBrZXlcbiAgY2F0Y2ggZXJyb3JcbiAgICByZXNjdWVOb3RGb3VuZCBlcnJvclxuICAgIG51bGxcblxuaGFzT2JqZWN0ID0gKG5hbWUsIGtleSkgLT5cbiAgaWYgKCBhd2FpdCBoZWFkT2JqZWN0IG5hbWUsIGtleSApPyB0aGVuIHRydWUgZWxzZSBmYWxzZVxuXG5nZXRPYmplY3QgPSAoIG5hbWUsIGtleSApIC0+XG4gIHRyeVxuICAgIGF3YWl0IEFXUy5TMy5nZXRPYmplY3QgQnVja2V0OiBuYW1lLCBLZXk6IGtleVxuICBjYXRjaCBlcnJvclxuICAgIHJlc2N1ZU5vdEZvdW5kIGVycm9yXG4gICAgbnVsbFxuXG5pc1MzT2JqZWN0ID0gKHZhbHVlKSAtPiAoIGlzT2JqZWN0IHZhbHVlICkgJiYgdmFsdWUuQm9keT9cblxuc3RyZWFtT2JqZWN0ID0gZ2VuZXJpYyBuYW1lOiBcInN0cmVhbU9iamVjdFwiXG5cbmdlbmVyaWMgc3RyZWFtT2JqZWN0LCBpc1MzT2JqZWN0LCBpc1N0cmluZywgKCB7IEJvZHkgfSwgZW5jb2RpbmcgKSAtPlxuICBpZiBlbmNvZGluZyA9PSBcImJpbmFyeVwiXG4gICAgQm9keVxuICBlbHNlXG4gICAgbmV3IFByb21pc2UgKHJlc29sdmUsIHJlamVjdCkgLT5cbiAgICAgIEJvZHkuc2V0RW5jb2RpbmcgZW5jb2RpbmdcbiAgICAgIG91dHB1dCA9IFwiXCJcbiAgICAgIEJvZHkub24gXCJkYXRhXCIsIChjaHVuaykgLT4gb3V0cHV0ICs9IGNodW5rXG4gICAgICBCb2R5Lm9uIFwiZXJyb3JcIiwgKGVycm9yKSAtPiByZWplY3QgZXJyb3JcbiAgICAgIEJvZHkub24gXCJlbmRcIiwgLT4gcmVzb2x2ZSBvdXRwdXRcblxuZ2VuZXJpYyBzdHJlYW1PYmplY3QsIGlzUzNPYmplY3QsICggb2JqZWN0ICkgLT5cbiAgc3RyZWFtT2JqZWN0IG9iamVjdCwgXCJ1dGY4XCJcblxuZ2VuZXJpYyBzdHJlYW1PYmplY3QsIGlzU3RyaW5nLCBpc1N0cmluZywgaXNTdHJpbmcsICggbmFtZSwga2V5LCBlbmNvZGluZyApIC0+XG4gIHN0cmVhbU9iamVjdCAoIGF3YWl0IGdldE9iamVjdCBuYW1lLCBrZXkgKSwgZW5jb2RpbmdcblxuZ2VuZXJpYyBzdHJlYW1PYmplY3QsIGlzU3RyaW5nLCBpc1N0cmluZywgKCBuYW1lLCBrZXkgKSAtPlxuICBzdHJlYW1PYmplY3QgYXdhaXQgZ2V0T2JqZWN0IG5hbWUsIGtleVxuXG5wdXRPYmplY3QgPSAocGFyYW1ldGVycykgLT5cbiAgQVdTLlMzLnB1dE9iamVjdCBwYXJhbWV0ZXJzXG5cbmRlbGV0ZU9iamVjdCA9IChuYW1lLCBrZXkpIC0+XG4gIGlmIGF3YWl0IGhhc09iamVjdCBuYW1lLCBrZXlcbiAgICBhd2FpdCBBV1MuUzMuZGVsZXRlT2JqZWN0IEJ1Y2tldDogbmFtZSwgS2V5OiBrZXlcblxuXG5kZWxldGVPYmplY3RzID0gKG5hbWUsIGtleXMpIC0+XG4gIGF3YWl0IEFXUy5TMy5kZWxldGVPYmplY3RzXG4gICAgQnVja2V0OiBuYW1lXG4gICAgRGVsZXRlOlxuICAgICAgT2JqZWN0czogKCBLZXk6IGtleSBmb3Iga2V5IGluIGtleXMgKVxuICAgICAgUXVpZXQ6IHRydWVcblxuXG5saXN0T2JqZWN0cyA9IChuYW1lLCBwcmVmaXgsIGl0ZW1zPVtdLCB0b2tlbikgLT5cbiAgcGFyYW1ldGVycyA9IFxuICAgIEJ1Y2tldDogbmFtZVxuICAgIE1heEtleXM6IDEwMDBcbiAgcGFyYW1ldGVycy5Db250aW51YXRpb25Ub2tlbiA9IHRva2VuIGlmIHRva2VuP1xuICBwYXJhbWV0ZXJzLlByZWZpeCA9IHByZWZpeCBpZiBwcmVmaXg/XG5cbiAge1xuICAgIElzVHJ1bmNhdGVkXG4gICAgQ29udGVudHNcbiAgICBOZXh0Q29udGludWF0aW9uVG9rZW5cbiAgfSA9IGF3YWl0IEFXUy5TMy5saXN0T2JqZWN0c1YyIHBhcmFtZXRlcnNcbiAgXG4gIGlmIElzVHJ1bmNhdGVkXG4gICAgaXRlbXMgPSBpdGVtcy5jb25jYXQgQ29udGVudHNcbiAgICBhd2FpdCBsaXN0T2JqZWN0cyBuYW1lLCBwcmVmaXgsIGl0ZW1zLCBOZXh0Q29udGludWF0aW9uVG9rZW5cbiAgZWxzZVxuICAgIGl0ZW1zLmNvbmNhdCBDb250ZW50c1xuXG5kZWxldGVEaXJlY3RvcnkgPSAobmFtZSwgcHJlZml4KSAtPlxuICBrZXlzID0gW11cbiAgZm9yIG9iamVjdCBpbiAoIGF3YWl0IGxpc3RPYmplY3RzIG5hbWUsIHByZWZpeCApXG4gICAga2V5cy5wdXNoIG9iamVjdC5LZXlcbiAgXG4gIGZvciBiYXRjaCBmcm9tIHBhcnRpdGlvbiAxMDAwLCBrZXlzXG4gICAgaWYgYmF0Y2gubGVuZ3RoID4gMCAjIElzIHRoaXMgbmVjY2Vzc2FyeT9cbiAgICAgIGF3YWl0IGRlbGV0ZU9iamVjdHMgbmFtZSwgYmF0Y2hcblxuZW1wdHlCdWNrZXQgPSAobmFtZSkgLT4gZGVsZXRlRGlyZWN0b3J5IG5hbWVcblxuZXhwb3J0IHtcbiAgZ2V0QnVja2V0QVJOXG4gIGhhc0J1Y2tldFxuICBwdXRCdWNrZXRcbiAgZGVsZXRlQnVja2V0XG4gIGRlbGV0ZURpcmVjdG9yeVxuICBlbXB0eUJ1Y2tldFxuXG4gIGdldEJ1Y2tldExpZmVjeWNsZVxuICBwdXRCdWNrZXRMaWZlY3ljbGVcbiAgZGVsZXRlQnVja2V0TGlmZWN5Y2xlXG5cbiAgcHV0QnVja2V0V2Vic2l0ZVxuICBwdXRCdWNrZXRSZWRpcmVjdFxuICBkZWxldGVCdWNrZXRXZWJzaXRlXG5cbiAgaGVhZE9iamVjdFxuICBoYXNPYmplY3RcbiAgZ2V0T2JqZWN0XG4gIHN0cmVhbU9iamVjdFxuICBwdXRPYmplY3RcbiAgZGVsZXRlT2JqZWN0XG4gIGRlbGV0ZU9iamVjdHNcbiAgbGlzdE9iamVjdHNcbn0iXSwic291cmNlUm9vdCI6IiJ9
//# sourceURL=src/bucket.coffee